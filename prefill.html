<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR URL Generator for Email Signatures</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <style>
        body {
            padding-top: 2em;
        }
        .main-container {
            width: 75%;
            max-width: 1140px;
            margin-left: auto;
            margin-right: auto;
        }
        .card {
            margin-top: 2em;
        }
        .card-header {
            background-color: #E8E8E8;
			padding: 15px;
        }
		
	

		.card-body {
            background-color: #FCFCFC;
			padding: 25px;
        }
		
		.form-control {
    margin-bottom: 20px; /* Adjust this value to control the space between input fields */
}

        .form-control::placeholder {
            color: lightgrey;
			
        }
        .btn-primary {
            background-color: #378768;
            border: none;
        }
        .btn-primary:hover {
            background-color: #4cc495;
            border: none;
        }
        #urlOutput {
            background-color: #e6f3ff;
            padding: 25px;
            border-radius: 5px;
			margin-bottom: 10px;
			
            word-wrap: break-word;
            cursor: pointer;
            transition: background-color 0.3s;
			width: 
			min-height: 120px; 
        }
        #urlOutput:hover {
            background-color: #d0e8ff;
        }
        #confirmation {
            opacity: 0;
            transition: opacity 0.5s;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ccffcc;
            padding: 25px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            z-index: 9999;
        }
        #confirmation.show {
            opacity: 1;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .error-message {
            color: red;
            font-size: 0.875em;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="jumbotron">
            <h1 class="display-4">HR URL Generator for Email Signatures</h1>
            <p class="lead">Generate a pre-filled URL for new employees to create their email signatures.</p>
        </div>

        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">1. Fill in the employee details</h5>
                    </div>
                    <div class="card-body">
                        <form id="employeeForm">
                            <!-- Form fields will be dynamically added here -->
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">2. Generated URL (Click to open in new window)</h5>
                    </div>
                    <div class="card-body">
                        <div id="urlOutput" role="button" tabindex="0"></div>
                        <button id="copyUrlButton" class="btn btn-primary mt-3">Copy URL to Clipboard</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="confirmation">
        URL has been <strong>copied to clipboard</strong>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="js/templator-input-formatters.js"></script>
    <script>
    (function () {
    const baseUrl = window.location.origin + window.location.pathname.replace('prefill.html', 'index.html');
    let templateFields = [];

  function loadTemplate() {
    console.log('Starting to load template...');
    $.get('template.html', function (data) {
        console.log('Template loaded. Content:', data);

        const regex = /\{\{([^}]+)\}\}/g;
        console.log('Using regex:', regex);

        let match;
        while ((match = regex.exec(data)) !== null) {
            console.log('Found match:', match);

            const fullMatch = match[0];
            const innerContent = match[1].trim();
            console.log('Full match:', fullMatch);
            console.log('Inner content:', innerContent);

            const parts = innerContent.split(/\s+(.+)/);
            const fieldName = parts[0];
            const attributesString = parts[1] || '';
            console.log('Field name:', fieldName);
            console.log('Attributes string:', attributesString);

            const attributes = {};
            const attributeRegex = /(\w+)="([^"]*)"/g;
            let attrMatch;
            while ((attrMatch = attributeRegex.exec(attributesString)) !== null) {
                console.log('Attribute match:', attrMatch);
                attributes[attrMatch[1]] = attrMatch[2];
            }
            console.log('Parsed attributes:', attributes);

            const existingFieldIndex = templateFields.findIndex(field => field.name === fieldName);
            if (existingFieldIndex === -1) {
                const newField = { name: fieldName, ...attributes };
                templateFields.push(newField);
                console.log('Added new field:', newField);
            } else {
                // Merge new attributes with existing field
                templateFields[existingFieldIndex] = { 
                    ...templateFields[existingFieldIndex], 
                    ...attributes 
                };
                console.log('Updated existing field:', templateFields[existingFieldIndex]);
            }
        }

        console.log('Final templateFields array:', templateFields);
        createForm();
    }).fail(function(jqXHR, textStatus, errorThrown) {
        console.error('Error loading template:', textStatus, errorThrown);
    });
}

    function createForm() {
        const form = $('#employeeForm');
        templateFields.forEach(field => {
            const formGroup = $('<div class="mb-3"></div>');
            const labelTitle = field.label || field.name;  // Set the label to the "label" attribute or fallback to the name
            const placeholderText = field.placeholder || '';  // Set placeholder text if available
            formGroup.append(`<label for="${field.name}" class="form-label">${labelTitle}</label>`);
            const input = $(`<input type="text" class="form-control" id="${field.name}" name="${field.name}" placeholder="${placeholderText}">`);
            formGroup.append(input);
            formGroup.append(`<div class="error-message" id="${field.name}-error"></div>`);
            form.append(formGroup);

            if (field.name.toLowerCase().includes('email')) {
                input.on('blur', Templator.InputFormatters.validateEmail);
            } else if (field.name.toLowerCase().includes('phone')) {
                input.on('input', Templator.InputFormatters.formatPhoneNumber);
            }
        });
        form.on('input', generateUrl);
    }

    function generateUrl() {
        let url = new URL(baseUrl);
        templateFields.forEach(field => {
            const value = $(`#${field.name}`).val();
            if (value) {
                url.searchParams.append(field.name, value);
            }
        });
        $('#urlOutput').text(url.toString());
    }

    function copyToClipboard() {
        const urlText = $('#urlOutput').text();
        navigator.clipboard.writeText(urlText).then(() => {
            showConfirmation();
        });
    }

    function showConfirmation() {
        const confirmation = $('#confirmation');
        confirmation.addClass('show');
        setTimeout(() => {
            confirmation.removeClass('show');
        }, 2000);
    }

    function openUrlInNewWindow() {
        const url = $('#urlOutput').text();
        if (url) {
            window.open(url, '_blank');
        }
    }

    $(document).ready(() => {
        loadTemplate();
        $('#copyUrlButton').on('click', copyToClipboard);
        $('#urlOutput').on('click', openUrlInNewWindow);
        $('#urlOutput').on('keypress', function (e) {
            if (e.which === 13) {
                openUrlInNewWindow();
            }
        });
    });
})();


    </script>
</body>
</html>